<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>AE Anchor Radial Menu - íë¦„ë„</title>
    <script src="https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js"></script>
    <style>
        body {
            font-family: 'Segoe UI', -apple-system, sans-serif;
            background: #1a1a2e;
            color: #e0e0e0;
            padding: 40px;
            margin: 0;
        }
        h1 { color: #4fc3f7; text-align: center; }
        h2 { color: #81c784; margin-top: 40px; border-bottom: 2px solid #81c784; padding-bottom: 10px; }
        .mermaid {
            background: #252542;
            padding: 20px;
            border-radius: 12px;
            margin: 20px 0;
        }
        .legend {
            background: rgba(255,255,255,0.05);
            padding: 20px;
            border-radius: 8px;
            margin: 20px 0;
        }
        .legend-item { margin: 8px 0; }
        .code { color: #4fc3f7; font-family: monospace; }
        .file { color: #ffb74d; font-family: monospace; }
    </style>
</head>
<body>
    <h1>ğŸ¯ AE Anchor Radial Menu - í”„ë¡œì íŠ¸ íë¦„ë„</h1>

    <div class="legend">
        <strong>ë²”ë¡€:</strong>
        <div class="legend-item">ğŸŸ¦ íŒŒë€ìƒ‰ = ì…ë ¥ (Input)</div>
        <div class="legend-item">ğŸŸ© ì´ˆë¡ìƒ‰ = ì²˜ë¦¬ (Process)</div>
        <div class="legend-item">ğŸŸ§ ì£¼í™©ìƒ‰ = ì¶œë ¥ (Output)</div>
        <div class="legend-item">ğŸ“ íŒŒì¼ëª… = í•´ë‹¹ ì½”ë“œ ìœ„ì¹˜</div>
    </div>

    <h2>1. í”ŒëŸ¬ê·¸ì¸ ì´ˆê¸°í™”</h2>
    <div class="mermaid">
flowchart LR
    subgraph INPUT["ì…ë ¥"]
        A["After Effects ì‹œì‘"]
    end

    subgraph PROCESS["ì²˜ë¦¬"]
        B["EntryPointFunc()"]
        C["KeyboardMonitor::Start()"]
        D["NativeUI::Initialize()"]
        E["CEPBridge::Initialize()"]
    end

    subgraph OUTPUT["ì¶œë ¥"]
        F["í”ŒëŸ¬ê·¸ì¸ ë“±ë¡ ì™„ë£Œ"]
        G["í‚¤ë³´ë“œ í›… í™œì„±í™”"]
    end

    A --> B
    B --> C
    B --> D
    B --> E
    C --> G
    D --> F
    E --> F

    style A fill:#2196f3
    style F fill:#ff9800
    style G fill:#ff9800
    </div>
    <p>ğŸ“ <span class="file">SnapPlugin.cpp</span> â†’ <span class="code">EntryPointFunc()</span></p>

    <h2>2. Yí‚¤ â†’ ì•µì»¤ ê·¸ë¦¬ë“œ (Grid ëª¨ë“ˆ)</h2>
    <div class="mermaid">
flowchart TD
    subgraph INPUT["ì…ë ¥"]
        A["Yí‚¤ ëˆ„ë¦„"]
    end

    subgraph PROCESS["ì²˜ë¦¬ - SnapPlugin.cpp"]
        B{"IsTextInputFocused()?"}
        C["0.4ì´ˆ ëŒ€ê¸°"]
        D{"ì•„ì§ ëˆ„ë¥´ê³  ìˆë‚˜?"}
        E["ShowAnchorGrid()"]
    end

    subgraph UI["UI - GridUI.cpp"]
        F["NativeUI::ShowGrid()"]
        G["3x3 ê·¸ë¦¬ë“œ í‘œì‹œ"]
        H{"ë§ˆìš°ìŠ¤ í´ë¦­?"}
    end

    subgraph OUTPUT["ì¶œë ¥"]
        I["HideAndApplyAnchor()"]
        J["ExecuteScript()"]
        K["ë ˆì´ì–´ ì•µì»¤ ë³€ê²½ë¨"]
    end

    A --> B
    B -->|No| C
    B -->|Yes| Z["ë¬´ì‹œ"]
    C --> D
    D -->|Yes| E
    D -->|No| Z
    E --> F
    F --> G
    G --> H
    H -->|Yes| I
    I --> J
    J --> K

    style A fill:#2196f3
    style K fill:#ff9800
    style Z fill:#666
    </div>

    <h2>2-1. Y~Y ë”ë¸”íƒ­ â†’ í† ê¸€ ëª¨ë“œ</h2>
    <div class="mermaid">
flowchart TD
    subgraph INPUT["ì…ë ¥"]
        A["Yí‚¤ ëˆ„ë¦„"]
        A2["Yí‚¤ ë—Œ"]
        A3["Yí‚¤ ë‹¤ì‹œ ëˆ„ë¦„\n250ms ë‚´"]
    end

    subgraph PROCESS["ì²˜ë¦¬ - SnapPlugin.cpp:1217"]
        B["g_lastYRelease ê¸°ë¡"]
        C{"timeSinceLastRelease\n< DOUBLE_TAP_MS?"}
        D["g_toggleClickMode = true"]
        E["ShowAnchorGrid()"]
    end

    subgraph UI["UI - GridUI.cpp"]
        F["ê·¸ë¦¬ë“œ ê³ ì • í‘œì‹œ\ní‚¤ ë–¼ë„ ì•ˆ ë‹«í˜"]
        G{"ë§ˆìš°ìŠ¤ í´ë¦­?"}
    end

    subgraph OUTPUT["ì¶œë ¥"]
        H["HideAndApplyAnchor()"]
        I["g_toggleClickMode = false"]
        J["ë ˆì´ì–´ ì•µì»¤ ë³€ê²½ë¨"]
    end

    A --> A2 --> B
    A3 --> C
    C -->|Yes ë”ë¸”íƒ­| D --> E --> F
    C -->|No| Z["ì¼ë°˜ í™€ë“œ ëª¨ë“œ"]
    F --> G
    G -->|Yes| H --> I --> J

    style A fill:#2196f3
    style A2 fill:#2196f3
    style A3 fill:#2196f3
    style J fill:#ff9800
    style Z fill:#666
    </div>
    <p>ğŸ“ <span class="file">SnapPlugin.cpp:1217-1230</span> â†’ ë”ë¸”íƒ­ ê°ì§€ ë¡œì§</p>
    <p>â±ï¸ <span class="code">DOUBLE_TAP_MS = 250</span> (250ms ë‚´ Y~Y)</p>

    <h2>3. Shift+E â†’ ì´í™íŠ¸ ê²€ìƒ‰ (Control ëª¨ë“ˆ)</h2>
    <div class="mermaid">
flowchart TD
    subgraph INPUT["ì…ë ¥"]
        A["Shift + E ëˆ„ë¦„"]
    end

    subgraph CHECK["ì²´í¬ - SnapPlugin.cpp"]
        B{"Effect Controls\ní¬ì»¤ìŠ¤?"}
    end

    subgraph MODE1["Mode 1: ê²€ìƒ‰ ëª¨ë“œ"]
        C["GetAllEffectsList()"]
        D["ControlUI::SetMode(SEARCH)"]
        E["ê²€ìƒ‰ì°½ í‘œì‹œ"]
        F["ì´í™íŠ¸ ê²€ìƒ‰/ì„ íƒ"]
    end

    subgraph MODE2["Mode 2: ëª©ë¡ ëª¨ë“œ"]
        G["GetLayerEffectsList()"]
        H["ControlUI::SetMode(LIST)"]
        I["ë ˆì´ì–´ ì´í™íŠ¸ ëª©ë¡"]
        J["ì´í™íŠ¸ ì‚­ì œ ê°€ëŠ¥"]
    end

    subgraph OUTPUT["ì¶œë ¥"]
        K["ExecuteScript()"]
        L["ì´í™íŠ¸ ì¶”ê°€/ì‚­ì œë¨"]
    end

    A --> B
    B -->|No| C
    B -->|Yes| G
    C --> D --> E --> F --> K
    G --> H --> I --> J --> K
    K --> L

    style A fill:#2196f3
    style L fill:#ff9800
    </div>

    <h2>4. Dí‚¤ â†’ ë©”ë‰´ (DMenu ëª¨ë“ˆ)</h2>
    <div class="mermaid">
flowchart TD
    subgraph INPUT["ì…ë ¥"]
        A["Dí‚¤ í™€ë“œ"]
    end

    subgraph MENU["DMenuUI.cpp"]
        B["DMenuUI::ShowMenu()"]
        C["A/T/K ì˜µì…˜ í‘œì‹œ"]
        D{"ì„ íƒ?"}
    end

    subgraph MODULES["ëª¨ë“ˆ ì‹¤í–‰"]
        E["A â†’ AlignUI"]
        F["T â†’ TextUI"]
        G["K â†’ KeyframeUI"]
    end

    subgraph OUTPUT["ì¶œë ¥"]
        H["í•´ë‹¹ íŒ¨ë„ í‘œì‹œ"]
    end

    A --> B --> C --> D
    D -->|A| E --> H
    D -->|T| F --> H
    D -->|K| G --> H

    style A fill:#2196f3
    style H fill:#ff9800
    </div>

    <h2>5. ì „ì²´ ì•„í‚¤í…ì²˜</h2>
    <div class="mermaid">
flowchart TB
    subgraph CORE["Core Layer"]
        A["SnapPlugin.cpp\në©”ì¸ ë¡œì§"]
        B["KeyboardMonitor.cpp\ní‚¤ë³´ë“œ ê°ì§€"]
        C["CEPBridge.cpp\nAE í†µì‹ "]
    end

    subgraph MODULES["Module Layer"]
        D["GridUI.cpp\nYí‚¤ - ì•µì»¤"]
        E["ControlUI.cpp\nShift+E - ì´í™íŠ¸"]
        F["KeyframeUI.cpp\nK - í‚¤í”„ë ˆì„"]
        G["AlignUI.cpp\nA - ì •ë ¬"]
        H["TextUI.cpp\nT - í…ìŠ¤íŠ¸"]
        I["DMenuUI.cpp\nD - ë©”ë‰´"]
        J["CompUI.cpp\nì»´í¬ì§€ì…˜"]
    end

    subgraph AE["After Effects"]
        K["ExtendScript\nì‹¤ì œ ì‘ì—… ìˆ˜í–‰"]
    end

    B --> A
    A --> D & E & F & G & H & I & J
    D & E & F & G & H & J --> C
    C --> K

    style CORE fill:#1e3a5f
    style MODULES fill:#2e4a3f
    style AE fill:#4a3a2e
    </div>

    <h2>6. ë°ì´í„° íë¦„ ìš”ì•½</h2>
    <div class="mermaid">
flowchart LR
    A["âŒ¨ï¸ í‚¤ë³´ë“œ ì…ë ¥"] --> B["ğŸ” í‚¤ ê°ì§€\nKeyboardMonitor"]
    B --> C["âš™ï¸ ë¡œì§ ì²˜ë¦¬\nSnapPlugin"]
    C --> D["ğŸ–¼ï¸ UI í‘œì‹œ\n*UI.cpp"]
    D --> E["ğŸ‘† ì‚¬ìš©ì ì„ íƒ"]
    E --> F["ğŸ“œ ìŠ¤í¬ë¦½íŠ¸ ì‹¤í–‰\nCEPBridge"]
    F --> G["ğŸ¬ After Effects\nì‹¤ì œ ì ìš©"]

    style A fill:#2196f3
    style G fill:#ff9800
    </div>

    <script>
        mermaid.initialize({
            startOnLoad: true,
            theme: 'dark',
            flowchart: {
                useMaxWidth: true,
                htmlLabels: true,
                curve: 'basis'
            }
        });
    </script>
</body>
</html>
