<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>Code Flow - AE Anchor Radial Menu</title>
    <script src="https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            color: #e0e0e0;
            min-height: 100vh;
            padding: 20px;
        }
        h1 { color: #4fc3f7; text-align: center; margin-bottom: 5px; }
        .subtitle { text-align: center; color: #888; margin-bottom: 15px; font-size: 14px; }
        .instructions {
            text-align: center;
            background: rgba(74, 158, 255, 0.15);
            border: 1px solid rgba(74, 158, 255, 0.3);
            border-radius: 8px;
            padding: 10px 20px;
            margin: 0 auto 20px auto;
            max-width: 500px;
            font-size: 13px;
        }
        .legend {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        .legend-item { display: flex; align-items: center; gap: 6px; font-size: 12px; }
        .legend-color { width: 14px; height: 14px; border-radius: 3px; }
        .flowchart {
            background: rgba(255,255,255,0.05);
            border-radius: 12px;
            padding: 20px;
            max-width: 1200px;
            margin: 0 auto;
            overflow: auto;
        }
        .mermaid { background: transparent; cursor: default; }
        .mermaid .node { cursor: pointer !important; }
        .mermaid .node:hover { filter: brightness(1.2); }
        .filters {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        .filter-item {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px 16px;
            background: rgba(255,255,255,0.1);
            border-radius: 8px;
            cursor: pointer;
            transition: background 0.2s;
        }
        .filter-item:hover { background: rgba(255,255,255,0.15); }
        .filter-item input { cursor: pointer; width: 16px; height: 16px; }
        .filter-item label { cursor: pointer; font-size: 14px; }
        .node-hidden { opacity: 0.15 !important; }
        .edge-hidden { opacity: 0.1 !important; }
        .toast {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%) translateY(100px);
            background: #4caf50;
            color: white;
            padding: 12px 24px;
            border-radius: 8px;
            font-size: 14px;
            font-family: monospace;
            transition: transform 0.3s;
            z-index: 1000;
            box-shadow: 0 4px 20px rgba(0,0,0,0.3);
        }
        .toast.show { transform: translateX(-50%) translateY(0); }
    </style>
</head>
<body>
    <h1>ğŸ” ì•Œê³ ë¦¬ì¦˜ íë¦„ë„</h1>
    <p class="subtitle">AE Anchor Radial Menu - ë…¸ë“œë¥¼ í´ë¦­í•˜ë©´ íŒŒì¼:ë¼ì¸ì´ ë³µì‚¬ë©ë‹ˆë‹¤</p>
    <div class="instructions">
        ğŸ’¡ <strong>ë…¸ë“œ í´ë¦­</strong> â†’ í´ë¦½ë³´ë“œì— ë³µì‚¬ â†’ í„°ë¯¸ë„ì— ë¶™ì—¬ë„£ê¸°
    </div>
    <div class="legend">
        <div class="legend-item"><div class="legend-color" style="background:#0d47a1"></div><span>ì…ë ¥</span></div>
        <div class="legend-item"><div class="legend-color" style="background:#0a3d62"></div><span>C++</span></div>
        <div class="legend-item"><div class="legend-color" style="background:#1b5e20"></div><span>ExtendScript</span></div>
        <div class="legend-item"><div class="legend-color" style="background:#b8860b"></div><span>CEP</span></div>
        <div class="legend-item"><div class="legend-color" style="background:#bf360c"></div><span>ê²°ê³¼</span></div>
    </div>
    <div class="filters">
        <div class="filter-item">
            <input type="checkbox" id="filter-y" checked onchange="updateFilter()">
            <label for="filter-y">Yí‚¤ (ì•µì»¤)</label>
        </div>
        <div class="filter-item">
            <input type="checkbox" id="filter-yy" checked onchange="updateFilter()">
            <label for="filter-yy">Y~Y ë”ë¸”íƒ­</label>
        </div>
        <div class="filter-item">
            <input type="checkbox" id="filter-e" checked onchange="updateFilter()">
            <label for="filter-e">Shift+E (ì´í™íŠ¸)</label>
        </div>
        <div class="filter-item">
            <input type="checkbox" id="filter-d" checked onchange="updateFilter()">
            <label for="filter-d">Dí‚¤ (ë©”ë‰´)</label>
        </div>
    </div>
    <div class="flowchart">
        <div class="mermaid">
flowchart TD
    subgraph INPUT["âŒ¨ï¸ ì…ë ¥"]
        I1(["Yí‚¤ ëˆ„ë¦„"])
        I2(["Yí‚¤ ë”ë¸”íƒ­"])
        I3(["Shift+E"])
        I4(["Dí‚¤"])
    end
    subgraph CPP["ğŸ”µ C++ - í‚¤ë³´ë“œ ê°ì§€ & UI"]
        C1(["ë©”ì¸ ë£¨í”„\ní‚¤ ì…ë ¥ ê°ì§€"])
        C2{"í…ìŠ¤íŠ¸ ì…ë ¥ ì¤‘?"}
        C3(["0.4ì´ˆ ëŒ€ê¸°"])
        C4{"ë”ë¸”íƒ­?\n250ms ë‚´"}
        C5(["ì•µì»¤ ê·¸ë¦¬ë“œ í‘œì‹œ"])
        C6(["í† ê¸€ ëª¨ë“œ ON"])
        C7(["ì´í™íŠ¸ íŒ¨ë„"])
        C8{"D ë©”ë‰´\nA/T/K ì„ íƒ"}
        C9(["ì•µì»¤ ì ìš©"])
    end
    subgraph ES["ğŸŸ¢ ExtendScript - AE ì‘ì—…"]
        E1(["ì•µì»¤ í¬ì¸íŠ¸ ì„¤ì •"])
        E2(["ì´í™íŠ¸ ì¶”ê°€"])
        E3(["ì´í™íŠ¸ ì‚­ì œ"])
        E4(["í‚¤í”„ë ˆì„ ì„¤ì •"])
        E5(["ë ˆì´ì–´ ì •ë ¬"])
        E6(["í…ìŠ¤íŠ¸ ì†ì„± ë³€ê²½"])
    end
    subgraph CEP["ğŸŸ¡ CEP - íŒ¨ë„ & ì„¤ì •"]
        P1(["ì„¤ì • ë¡œë“œ"])
        P2(["ì„¤ì • ì €ì¥"])
        P3(["ì •ë ¬ íŒ¨ë„"])
        P4(["í…ìŠ¤íŠ¸ íŒ¨ë„"])
        P5(["í‚¤í”„ë ˆì„ íŒ¨ë„"])
    end
    subgraph OUTPUT["ğŸŸ  ê²°ê³¼"]
        O1(["ì•µì»¤ ì´ë™ë¨"])
        O2(["ì´í™íŠ¸ ì ìš©ë¨"])
        O3(["í‚¤í”„ë ˆì„ ìƒì„±ë¨"])
        O4(["ë ˆì´ì–´ ì •ë ¬ë¨"])
        O5(["í…ìŠ¤íŠ¸ ë³€ê²½ë¨"])
    end

    I1 -->|"Yí‚¤ ì‹ í˜¸"| C1
    I2 -->|"ë”ë¸”íƒ­ ì‹ í˜¸"| C1
    I3 -->|"Shift+E ì‹ í˜¸"| C7
    I4 -->|"Dí‚¤ ì‹ í˜¸"| C8
    C1 -->|"í˜„ì¬ í¬ì»¤ìŠ¤ ì°½"| C2
    C2 -->|"ì•„ë‹ˆì˜¤"| C3
    C2 -->|"ì˜ˆ"| X1["ë¬´ì‹œ"]
    C3 -->|"0.4ì´ˆ í›„"| C4
    C4 -->|"í™€ë“œ ì¤‘"| C5
    C4 -->|"ë”ë¸”íƒ­ ê°ì§€"| C6
    C6 -->|"ê³ ì • ëª¨ë“œ"| C5
    C5 -->|"ì„ íƒí•œ ì…€ ìœ„ì¹˜"| C9
    C9 -->|"ìŠ¤í¬ë¦½íŠ¸ ì½”ë“œ"| E1
    E1 -->|"x, y ì¢Œí‘œ"| O1
    C7 -->|"ì´í™íŠ¸ ì´ë¦„"| E2
    E2 -->|"ì´í™íŠ¸ ê°ì²´"| O2
    C7 -->|"ì´í™íŠ¸ ë²ˆí˜¸"| E3
    E3 -->|"ì‚­ì œ ì™„ë£Œ"| O2
    C8 -->|"A ì„ íƒ"| P3
    C8 -->|"T ì„ íƒ"| P4
    C8 -->|"K ì„ íƒ"| P5
    P3 -->|"ì •ë ¬ ë°©í–¥"| E5
    P4 -->|"í…ìŠ¤íŠ¸ ì„¤ì •"| E6
    P5 -->|"í‚¤í”„ë ˆì„ ì„¤ì •ê°’"| E4
    E4 -->|"ì‹œê°„, ê°’"| O3
    E5 -->|"ìœ„ì¹˜ ê°’"| O4
    E6 -->|"ì†ì„± ê°’"| O5
    C5 -.->|"ê·¸ë¦¬ë“œ ì„¤ì •"| P1
    P2 -.->|"ì €ì¥ëœ ì„¤ì •"| C5

    style INPUT fill:#0d47a1,color:#fff,stroke:#1565c0,stroke-width:2px
    style CPP fill:#0a3d62,color:#fff,stroke:#1565c0,stroke-width:2px
    style ES fill:#1b5e20,color:#fff,stroke:#2e7d32,stroke-width:2px
    style CEP fill:#b8860b,color:#fff,stroke:#f9a825,stroke-width:2px
    style OUTPUT fill:#bf360c,color:#fff,stroke:#e65100,stroke-width:2px
    style X1 fill:#666,color:#fff
        </div>
    </div>
    <div class="toast" id="toast"></div>
    <script>
        const nodeLocations = {"I1": "input:Yí‚¤", "I2": "input:Yí‚¤ ë”ë¸”íƒ­", "I3": "input:Shift+E", "I4": "input:Dí‚¤", "C1": "/Users/kimhyunjoong/projects/ae-anchor-radial-menu/cpp/src/core/SnapPlugin.cpp:1200", "C2": "/Users/kimhyunjoong/projects/ae-anchor-radial-menu/cpp/src/core/SnapPlugin.cpp:65", "C3": "/Users/kimhyunjoong/projects/ae-anchor-radial-menu/cpp/src/core/SnapPlugin.cpp:1210", "C4": "/Users/kimhyunjoong/projects/ae-anchor-radial-menu/cpp/src/core/SnapPlugin.cpp:1217", "C5": "/Users/kimhyunjoong/projects/ae-anchor-radial-menu/cpp/src/core/SnapPlugin.cpp:1100", "C6": "/Users/kimhyunjoong/projects/ae-anchor-radial-menu/cpp/src/core/SnapPlugin.cpp:1225", "C7": "/Users/kimhyunjoong/projects/ae-anchor-radial-menu/cpp/src/modules/control/ControlUI.cpp:1", "C8": "/Users/kimhyunjoong/projects/ae-anchor-radial-menu/cpp/src/modules/dmenu/DMenuUI.cpp:1", "C9": "/Users/kimhyunjoong/projects/ae-anchor-radial-menu/cpp/src/core/SnapPlugin.cpp:1050", "E1": "ExtendScript:layer.anchorPoint", "E2": "ExtendScript:addProperty", "E3": "ExtendScript:remove", "E4": "ExtendScript:setValueAtTime", "E5": "ExtendScript:layer.position", "E6": "ExtendScript:textDocument", "P1": "/Users/kimhyunjoong/projects/ae-anchor-radial-menu/cep/js/core/settings.js:1", "P2": "/Users/kimhyunjoong/projects/ae-anchor-radial-menu/cep/js/core/settings.js:50", "P3": "/Users/kimhyunjoong/projects/ae-anchor-radial-menu/cep/js/modules/align.js:1", "P4": "/Users/kimhyunjoong/projects/ae-anchor-radial-menu/cep/js/modules/text.js:1", "P5": "/Users/kimhyunjoong/projects/ae-anchor-radial-menu/cep/js/modules/keyframe.js:1", "O1": "output:ì•µì»¤ ì´ë™", "O2": "output:ì´í™íŠ¸ ì ìš©", "O3": "output:í‚¤í”„ë ˆì„ ìƒì„±", "O4": "output:ë ˆì´ì–´ ì •ë ¬", "O5": "output:í…ìŠ¤íŠ¸ ë³€ê²½"};

        function showToast(msg) {
            const toast = document.getElementById('toast');
            toast.textContent = msg;
            toast.classList.add('show');
            setTimeout(function() { toast.classList.remove('show'); }, 2500);
        }

        function copyToClipboard(text) {
            navigator.clipboard.writeText(text).then(function() {
                showToast('ğŸ“‹ ë³µì‚¬ë¨: ' + text);
            });
        }

        mermaid.initialize({
            startOnLoad: true,
            theme: 'dark',
            flowchart: { useMaxWidth: true, curve: 'basis', nodeSpacing: 50, rankSpacing: 80 },
            securityLevel: 'loose'
        });

        // ê° ì…ë ¥ë³„ ê´€ë ¨ ë…¸ë“œ ì •ì˜
        const flowNodes = {
            'y': ['I1', 'C1', 'C2', 'C3', 'C4', 'C5', 'C9', 'E1', 'O1', 'P1', 'P2', 'X1'],
            'yy': ['I2', 'C1', 'C2', 'C3', 'C4', 'C5', 'C6', 'C9', 'E1', 'O1', 'P1', 'P2'],
            'e': ['I3', 'C7', 'E2', 'E3', 'O2'],
            'd': ['I4', 'C8', 'P3', 'P4', 'P5', 'E4', 'E5', 'E6', 'O3', 'O4', 'O5']
        };

        function updateFilter() {
            const yChecked = document.getElementById('filter-y').checked;
            const yyChecked = document.getElementById('filter-yy').checked;
            const eChecked = document.getElementById('filter-e').checked;
            const dChecked = document.getElementById('filter-d').checked;

            // í™œì„±í™”ëœ ë…¸ë“œ ìˆ˜ì§‘
            const activeNodes = new Set();
            if (yChecked) flowNodes['y'].forEach(n => activeNodes.add(n));
            if (yyChecked) flowNodes['yy'].forEach(n => activeNodes.add(n));
            if (eChecked) flowNodes['e'].forEach(n => activeNodes.add(n));
            if (dChecked) flowNodes['d'].forEach(n => activeNodes.add(n));

            // ë…¸ë“œ í‘œì‹œ/ìˆ¨ê¹€
            document.querySelectorAll('.node').forEach(function(node) {
                const nodeId = node.id.replace('flowchart-', '').split('-')[0];
                if (activeNodes.size === 0 || activeNodes.has(nodeId)) {
                    node.classList.remove('node-hidden');
                } else {
                    node.classList.add('node-hidden');
                }
            });

            // ì—£ì§€(í™”ì‚´í‘œ) í‘œì‹œ/ìˆ¨ê¹€
            document.querySelectorAll('.edgePath, .edgeLabel').forEach(function(edge) {
                const edgeId = edge.id || '';
                let shouldShow = false;
                activeNodes.forEach(function(n) {
                    if (edgeId.includes(n)) shouldShow = true;
                });
                if (activeNodes.size === 0 || shouldShow) {
                    edge.classList.remove('edge-hidden');
                } else {
                    edge.classList.add('edge-hidden');
                }
            });
        }

        // ë…¸ë“œ í´ë¦­ ì´ë²¤íŠ¸ ì—°ê²°
        setTimeout(function() {
            document.querySelectorAll('.node').forEach(function(node) {
                const nodeId = node.id.replace('flowchart-', '').split('-')[0];
                if (nodeLocations[nodeId]) {
                    node.style.cursor = 'pointer';
                    node.addEventListener('click', function() {
                        copyToClipboard(nodeLocations[nodeId]);
                    });
                }
            });
        }, 500);
    </script>
</body>
</html>